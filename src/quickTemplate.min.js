module.exports=function(m,k,e,g){function q(){r.readFile(k,"utf8",function(a,b){a?g("Quicktemplate file read error: "+k,void 0):n(b)})}function n(a){c=a;c=function d(){c=c.replace(new RegExp("\\|.*"+f),function(a){return a.substr(a.indexOf(f))});c.match(new RegExp("\\|.*"+f))&&d();return c}().replace(new RegExp(l+"\\s+","g"),l).replace(new RegExp("\\s+"+f,"g"),f);p(m)}function p(a,b,d){void 0===d&&void 0===b&&(d=[],h=b=0);for(keys in a)if(a.hasOwnProperty(keys)&&typeof a[keys]){if("object"!==typeof a[keys]||
a[keys]instanceof Array){var e=b?(b?d.join("."):"")+"."+keys:keys;c=c.replace(new RegExp(l+e+f,"g"),a[keys])}else d[b]=keys,p(a[keys],b+1,d);d.splice(b,Object.keys(a).length-b);0===b&&(h+=1);h===Object.keys(a).length&&g(null,c)}}var r=require("fs"),l=e.tokenLeft||"{{",f=e.tokenRight||"}}",h,c;"function"!==typeof e||g||(g=e);"object"!==typeof m?g("Quicktemplate object parameter is not an object",void 0):e.string?n(k):q()};